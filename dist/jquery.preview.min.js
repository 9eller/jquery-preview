/*! jQuery Preview - v3.0.0 - 2013-01-24
* https://github.com/embedly/jquery-preview
* Copyright (c) 2013 Sean Creeley; Licensed BSD */
(function(e){var t=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function n(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,i){var s=1,o=r.length,u="",a,f=[],l,c,h,p,d,v;for(l=0;l<o;l++){u=e(r[l]);if(u==="string")f.push(r[l]);else if(u==="array"){h=r[l];if(h[2]){a=i[s];for(c=0;c<h[2].length;c++){if(!a.hasOwnProperty(h[2][c]))throw t('[sprintf] property "%s" does not exist',h[2][c]);a=a[h[2][c]]}}else h[1]?a=i[h[1]]:a=i[s++];if(/[^s]/.test(h[8])&&e(a)!="number")throw t("[sprintf] expecting number but found %s",e(a));switch(h[8]){case"b":a=a.toString(2);break;case"c":a=String.fromCharCode(a);break;case"d":a=parseInt(a,10);break;case"e":a=h[7]?a.toExponential(h[7]):a.toExponential();break;case"f":a=h[7]?parseFloat(a).toFixed(h[7]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=String(a))&&h[7]?a.substring(0,h[7]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(h[8])&&h[3]&&a>=0?"+"+a:a,d=h[4]?h[4]=="0"?"0":h[4].charAt(1):" ",v=h[6]-String(a).length,p=h[6]?n(d,v):"",f.push(h[5]?a+p:p+a)}}return f.join("")},r.cache={},r.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw"[sprintf] huh?";if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw"[sprintf] huh?";s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw"[sprintf] huh?";s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},r}(),n=function(e,n){return n.unshift(e),t.apply(null,n)};(function(e){var t=["original_url","url","type","provider_url","provider_display","provider_name","favicon_url","title","description","thumbnail_url","author_name","author_url","object_type","object_html","object_url","object_width","object_height"];e.fn.addInputs=function(n,r){return e(this).each(function(){r=e.isArray(r)?r:t;var i=e(this);e.each(r,function(t,r){var s="";if(r.indexOf("object")===0){var o=r.split("_")[1];n.object.hasOwnProperty(o)&&(s=n.object[o])}else n.hasOwnProperty(r)&&(s=n[r]);var u=e('<input type="hidden"/>').attr({name:r,value:escape(s)});i.append(u)})})}})(jQuery,window,document),function(e){var t=function(e,t){this.init(e,t)};t.prototype={init:function(t,n){this.$elem=e(t),this.options=e.extend({},{onchange:e.noop},n),this.$elem.find(".left").on("click",e.proxy(this.scroll,this)),this.$elem.find(".right").on("click",e.proxy(this.scroll,this)),this.$elem.find(".nothumb").on("click",e.proxy(this.nothumb,this)),this.$elem.one("mouseenter",function(){e(this).on("mouseenter mouseleave",function(){e(this).find(".controls").toggle()})})},scroll:function(t){t.preventDefault();var n=this.$elem.find(".images"),r=parseInt(n.find("li").css("width"),10),i=parseInt(n.css("left"),10),s=n.find("img").length*r;if(e(t.target).hasClass("left")){i=parseInt(i,10)+r;if(i>0)return!1}else{i=parseInt(i,10)-r;if(i<=-s)return!1}var o=n.find("img").eq(i/-r);this.options.onchange.call(o,o),n.css("left",i+"px")},nothumb:function(e){e.preventDefault(),this.$elem.hide(),this.options.onchange.call(null,null)}},e.fn.thumb=function(n){return e(this).each(function(){e(this).data("thumb",new t(this,n))})}}(jQuery),function(e){var n=function(){};n.prototype={protocolExp:/^http(s?):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i,urlExp:/[-\w]+(\.[a-z]{2,})+(\S+)?(\/|\/[\w#!:.?+=&%@!\-\/])?/gi,url:function(t){t=e.trim(t);if(t==="")return null;var n=t.match(this.protocolExp),r=n?n[0]:null;return r===null&&(n=t.match(this.urlExp),r=n?"http://"+n[0]:null),r=e.trim(r),r===""?null:r},none:function(e){return e===null||e===undefined}};var r=new n,i=function(e){this.init(e)};i.prototype={init:function(e){this.options=e},render:function(n,i,s){this.preview=s;var o=e.extend(!0,{},i);o.title=o.title?o.title:o.url;var u=o.favicon_url?'<img class="favicon" src="%(favicon_url)s">':"",a=o.images.map(function(e){return t('<li><img src="%(url)s"/></li>',e)}).join("");a!==""&&(a=['<div class="thumb">','<div class="controls">','<a class="left" href="#">&#9664;</a>','<a class="right" href="#">&#9654;</a>','<a class="nothumb" href="#">&#10005;</a>',"</div>",'<div class="items">','<ul class="images">',a,"</ul>","</div>","</div>"].join(""));var f=['<div class="selector">',a,'<div class="attributes">','<a class="title" href="#" contenteditable=true>%(title)s</a>','<p><a class="description" href="#" contenteditable=true>%(description)s</a></p>','<span class="meta">',u,'<a class="provider" href="%(provider_url)s">%(provider_display)s</a>',"</span>","</div>",'<div class="action"><a href="#" class="close">&#10005;</a></div>',"</div>"].join(""),l=t(f,o),c=n.closest(this.options.container).find(this.options.wrapper).eq(0);c.length===0&&(c=e(this.options.wrapper).eq(0));if(c.length!==1)return!1;c.html(e(l)),c.find(".thumb").thumb({onchange:e.proxy(function(t){r.none(t)?this.preview.update("thumbnail_url",null):this.preview.update("thumbnail_url",e(t).attr("src"))},this)}),c.find(".title").on("blur",e.proxy(function(t){this.preview.update("title",e(t.target).text())},this)),c.find(".description").on("blur",e.proxy(function(t){this.preview.update("description",e(t.target).text())},this)),c.find(".action .close").bind("click",e.proxy(function(e){this.preview.clear(),n.trigger("closed"),c.find(".selector").remove()},this)),c.find(".selector").bind("mouseenter mouseleave",function(){e(this).find(".action").toggle()}),n.on("close",function(){c.find(".selector").remove()})}};var s={debug:!0,selector:{wrapper:".selector-wrapper",container:"form"},preview:{},field:null,query:{wmode:"opaque",words:30,maxwidth:560}},o=function(e,t){this.init(e,t)};o.prototype={$form:null,data:{},init:function(t,n){this.elem=t,this.$elem=e(t),this.url=null;var r=this.$elem.parents("form").eq(0);r.length===1&&(this.$form=r),this.options=e.extend({},s,n),this.$elem.on("keyup",e.proxy(this.keyUp,this)),this.$elem.on("paste",e.proxy(this.paste,this)),this.$elem.on("blur",e.proxy(this.paste,this)),this.$elem.on("close",e.proxy(this.clear,this)),this.$elem.data("preview",{})},log:function(){this.options.debug&&window.console&&window.console.log(Array.prototype.slice.call(arguments))},update:function(e,t){var n=this.$elem.data("preview");n[e]=t},clear:function(){this.$elem.data("preview",{})},keyUp:function(e){if(e.which!==32&&e.which!==13&&e.which!==8)return null;var t=r.url(this.$elem.val());this.log("onKeyUp url:"+t);if(t===null)return this.$elem.trigger("close"),null;this.fetch(t)},paste:function(t){setTimeout(e.proxy(function(){this.fetch()},this),200)},fetch:function(t){t===undefined&&(t=r.url(this.$elem.val())),this.log(t);if(t===null||this.url===t)return!1;this.$elem.trigger("close"),this.url=t,this.$elem.trigger("loading"),e.embedly.preview(t,{key:this.options.key,query:this.options.query}).progress(e.proxy(this._callback,this))},error:function(e){},_callback:function(e){this.log(e),this.$elem.trigger("loaded");if(!e.hasOwnProperty("type"))return this.log("Embedly returned an invalid response"),this.error(e),!1;if(e.type==="error")return this.log("URL ("+e.url+") returned an error: "+e.error_message),this.error(e),!1;if(!e.safe)return this.log("URL ("+e.url+") was deemed unsafe: "+e.safe_message),this.error(e),!1;if(!(e.type in{html:"",image:""}))return this.log("URL ("+e.url+") returned a type ("+e.type+") not handled"),this.error(e),!1;e.images.length>0&&(e.thumbnail_url=e.images[0].url),this.$elem.data("preview",e);var t;this.options.selector.hasOwnProperty("render")?t=this.options.selector:t=new i(this.options.selector),t.render(this.$elem,e,this),this.log("done",e)}},e.fn.preview=function(t,n){return e(this).each(function(e,n){new o(this,t)})}}(jQuery,window,document)})(jQuery,window,document);