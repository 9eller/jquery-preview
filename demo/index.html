<!DOCTYPE html>
<html>
  <head>
    <link rel="shortcut icon" href="http://embed.ly/static/favicon.ico">
    <script src="../lib/jquery.min.js" type="text/javascript" ></script>
    <script src="../lib/jquery.embedly.js" type="text/javascript"></script>
    <script src="../lib/mustache.js" type="text/javascript"></script>
    <script src="../dist/jquery.preview.js" type="text/javascript"></script>
    <link rel="stylesheet" href="common/css/foundation.min.css">
    <link rel="stylesheet" href="common/css/font-awesome.min.css">
    <link rel="stylesheet" href="common/css/demo.css" />
    <link rel="stylesheet" href="../css/preview.css" />
    <title>jQuery Preview - Link</title>
  </head>
  <body>
    <nav class="top-bar">
      <ul class="title-area">
        <li class="name">
          <h1><a href="index.html">jQuery Preview</a></h1>
        </li>
      </ul>
      <section class="top-bar-section">
        <ul class="right">
          <li><a href="status.html">Status</a></li>
          <li><a href="link.html">Link</a></li>
          <li><a href="multi.html">Multiple Inputs</a></li>
        </ul>
      </section>
    </nav>
    <div class="row">
      <div class="large-12 columns">
        <div class="panel">
          <h1> jQuery Preview <a id="doc" href="https://github.com/embedly/jquery-preview" class="button">Get the Code &raquo;</a></h1>
          <p>
            <a href="https://github.com/embedly/jquery-preview">jQuery Preview</a>
            is a plugin that allows users to preview URLs before
            submitting them to be saved by an application. Facebook, Google+
            and Yammer are all examples of tools with this functionality.
          </p>

          <form id="preview_form" class="form-vertical" method="post" action=".">
            <div class="arrow">
              <p>Try it out.</p>
              <img src='../images/arrow.png'>
            </div>
            <div class="row collapse">
              <div class="large-8 columns">
                <input type="text" class="input-xxlarge" name="url" id="id_url" value="http://vimeo.com/18150336" />
              </div>
              <div class="large-3 end columns">
                <a id="id_attach" class="button postfix">Attach</a>
              </div>
            </div>
            <!-- Placeholder that tells Preview where to put the loading icon-->

            <!-- Placeholder that tells Preview where to put the selector-->
            <div class="row">
              <div class="large-11 columns end">
            <div class="selector-wrapper"></div>
              </div>
            </div>
          </form>
          <div id="feed"></div>
        </div>
        <div class="row">
          <div class="large-11 large-centered columns">

<!--
Generated from the README.rest.
run python watch.py --html
-->
p>jQuery Preview is a plugin by <a class="reference external" href="http://embed.ly">Embedly</a> that allows
developers to create tools that enable users to share links with rich previews
attached. This method of letting users select thumbnails, edit title and
description has been adopted as the norm across the web. This plugin allows
developers to easily implement this functionality without building the entire
infrastructure themselves. Instead relying on on Embedly to generate the
metadata.</p>
<p>We have made this plugin overly verbose and infinitely customizable. Our goal
is not to dictate design, merely give a set of tools to make it easy to create
a custom experience. There are 5 different demos that you should take a look at
before getting started. It will give you a quick overview of what you should be
able to build.</p>
<ul class="simple">
<li><a class="reference external" href="http://embedly.github.com/jquery-preview/demo/link.html">Link</a></li>
<li><a class="reference external" href="http://embedly.github.com/jquery-preview/demo/status.html">Status</a></li>
<li><a class="reference external" href="http://embedly.github.com/jquery-preview/demo/multi.html">Multipe Inputs</a></li>
</ul>
<div class="section" id="basic-setup">
<h1>Basic Setup</h1>
<p>To get started you need to put <a class="reference external" href="http://jquery.com/">jQuery</a>,
<a class="reference external" href="https://github.com/embedly/jquery-preview/blob/master/jquery.preview.full.js">jquery.preview.full.js</a>
and <a class="reference external" href="https://github.com/embedly/jquery-preview/blob/master/css/preview.css">preview.css</a>. into
the <tt class="docutils literal">head</tt> of your page:</p>
<pre class="literal-block">
&lt;head&gt;
  &lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;http://scripts.embed.ly/p/0.2/jquery.preview.full.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;http://scripts.embed.ly/p/0.2/css/preview.css&quot; /&gt;
&lt;/head&gt;
</pre>
<p>jquery.preview.full.js bundles <a class="reference external" href="http://documentcloud.github.com/underscore/">Underscore.js</a> and <a class="reference external" href="https://github.com/janl/mustache.js/">Mustache.js</a> in with jquery.preview.js. If you
already have or use these two libs you can see up the <tt class="docutils literal">head</tt> of the document
like so:</p>
<pre class="literal-block">
&lt;head&gt;
  &lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;lib/mustache.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;lib/underscore.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;http://scripts.embed.ly/p/0.2/jquery.preview.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;http://scripts.embed.ly/p/0.2/css/preview.css&quot; /&gt;
&lt;/head&gt;
</pre>
<p>Next set up a simple form that allows a user to input link:</p>
<pre class="literal-block">
&lt;form action=&quot;/update&quot; method=&quot;POST&quot;&gt;
    &lt;input id=&quot;url&quot; type=&quot;text&quot; name=&quot;url&quot;/&gt;

    &lt;!-- Placeholder that tells Preview where to put the selector--&gt;
    &lt;div class=&quot;selector-wrapper&quot;&gt;&lt;/div&gt;
&lt;/form&gt;
</pre>
<p>You then need to tell preview what field to listen to:</p>
<pre class="literal-block">
&lt;script&gt;
    // Set up preview.
    $('#url').preview({key:'your_embedly_key'})

    // On submit add hidden inputs to the form.
    $('form').on('submit', function(){
      $(this).addInputs($('#url').data('preview'));
      return true;
    });
&lt;/script&gt;
</pre>
<p>And you are done setting up the front end solution for jQuery Preview. The
rest of this document will go into how to customize Preview.</p>
<p>Note that the <a class="reference external" href="http://embed.ly/docs/endpoints/1/preview">Preview</a> endpoint is
only available to Embedly developers with a Starter plan or above. You can sign
up for a Starter plan at <a class="reference external" href="http://embed.ly/pricing">embed.ly/pricing</a>.</p>
</div>
<div class="section" id="how-it-works">
<h1>How it Works</h1>
<p>The plugin works by listening to the field on <tt class="docutils literal">paste</tt>, <tt class="docutils literal">keyup</tt>, <tt class="docutils literal">preview</tt>
and <tt class="docutils literal">blur</tt>. If a URL is entered a call is made to Embedly's <a class="reference external" href="http://embed.ly/docs/extract/api/endpoints/1/extract">Extract</a> endpoint and the
result is then passed to the <tt class="docutils literal">render</tt> function. <tt class="docutils literal">render</tt> uses <tt class="docutils literal">sprintf</tt>
to create a selector, so the user can pick a thumbnail associated with the
URL.</p>
<p>jQuery Preview just saves all the data and changes associated with the URL on
the input using jQuery's data. It's up to the developer to choose how they want
to deal with that data on submit. jQuery Preview comes with a helper function
<tt class="docutils literal">addInputs</tt> so all the data can be added to the form. This is the code to
enable it:</p>
<pre class="literal-block">
// On submit add hidden inputs to the form.
$('form').on('submit', function(){
  $(this).addInputs($('#url').data('preview'));
  return true;
});
</pre>
<p>The developer can then choose how they wish to display the preview in the feed.
We will show some simple examples for handling this in the documentation.</p>
</div>
<div class="section" id="id1">
<h1>Preview</h1>
<p>Preview holds all the logic for calls to Embedly and rendering the selector.</p>
<div class="section" id="options">
<h2>Options</h2>
<dl class="docutils">
<dt><tt class="docutils literal">bind</tt></dt>
<dd><p class="first">By default preview will bind to <tt class="docutils literal">keyup</tt>, <tt class="docutils literal">blur</tt> and <tt class="docutils literal">paste</tt> if you
wish to define your own bindings you can set this attribute to false:</p>
<pre class="last literal-block">
// Don't bind the listeners
$('#url').preview({bind:false});

// When a use hits Attach, trigger a preview of the link.
$('a.attach').on('click', function(){$('#url').trigger('preview')});
</pre>
</dd>
<dt><tt class="docutils literal">error</tt></dt>
<dd><p class="first">Called when the url that the user inputed throws an error somewhere along
the way. Depending on the use case you may want notify the user or hide it
from them. The default behavior is to not notify the user. To notify them
you can use:</p>
<pre class="last literal-block">
$('#url').preview({
  error: function(obj){
    alert('The URL you entered was not processed.');
  }});
</pre>
</dd>
<dt><tt class="docutils literal">success</tt></dt>
<dd><p class="first">Called after a URL has been successfully rendered by the selector. Useful
if you want to change state after the URL has been successfully processed.
For example if you want to change a button from 'Share' to 'Submit' you can
do it like so:</p>
<pre class="last literal-block">
$('#url').preview({
  success : function(obj){
    $('button').text('Submit');
  }
});
</pre>
</dd>
</dl>
<p><tt class="docutils literal">render</tt></p>
<blockquote>
<p>If you would like to create your own selector, overwrite <tt class="docutils literal">render</tt> with
your own function. We will go in more detail, in the writing your own
selector function, but here is the simplest example I could think of.</p>
<blockquote>
<dl class="docutils">
<dt>$('#url').preview({</dt>
<dd><dl class="first docutils">
<dt>render: function(obj, options){</dt>
<dd>// Put the title after the input.
$(this).after(obj.title);</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 153)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p class="last">}});</p>
</dd>
</dl>
</blockquote>
</blockquote>
</div>
<div class="section" id="events">
<h2>Events</h2>
<dl class="docutils">
<dt><tt class="docutils literal">preview</tt></dt>
<dd><p class="first">Manually trigger the input to fetch the URL. This is generally only needed
if <tt class="docutils literal">bind</tt> is set to false:</p>
<pre class="last literal-block">
$('a.attach').on('click', function(){$('#url').trigger('preview')});
</pre>
</dd>
<dt><tt class="docutils literal">loading</tt></dt>
<dd><p class="first">Triggered when the request is being made to the API endpoint:</p>
<pre class="last literal-block">
$('#url').on('loading', function(){$('.loading').show()});
</pre>
</dd>
<dt><tt class="docutils literal">loaded</tt></dt>
<dd><p class="first">Triggered when a response has been returned from the API endpoint:</p>
<pre class="last literal-block">
$('#url').on('loaded', function(){$('.loading').hide()});
</pre>
</dd>
<dt><tt class="docutils literal">close</tt></dt>
<dd><p class="first">Triggered when the selector should be closed. If you are implementing a
custom selector, you must listen for this event.</p>
<blockquote class="last">
<dl class="docutils">
<dt>var render = function(data, options){</dt>
<dd><p class="first">// Insert selector
$(this).on('close', function(){</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">&lt;string&gt;</tt>, line 181)</p>
Unexpected indentation.</div>
<blockquote>
//Remove selector.</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 182)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<p class="last">});</p>
</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 183)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>}</p>
</blockquote>
</dd>
</dl>
</div>
</div>
<div class="section" id="custom-selector">
<h1>Custom Selector</h1>
<p>It's actually recommended that you build a custom selector. While the default
one is pretty good, you are going to want to customize it more than just the
default styles. Here's how you can create your own.</p>
<div class="section" id="render">
<h2>Render</h2>
<p>To create our own selector you just need to pass in a function into the
<tt class="docutils literal">render</tt> option when calling preview:</p>
<pre class="literal-block">
var render = function(data, options){
  // custom render
};
$('#url').preview({render:render});
</pre>
<p>The render function should accept a <tt class="docutils literal">data</tt> argument that is the response from
the <tt class="docutils literal">extract</tt> endpoint. <tt class="docutils literal">options</tt> is also passed in if you would like to
set custom options in preview. <tt class="docutils literal">this</tt> is the HTMLElement of the input. This
will let you listen for events or trigger events on the input.</p>
<p>The simplest version of a custom selector looks like so:</p>
<pre class="literal-block">
var render = function(data, options){
  // Add the title after the input.
  $(this).after('&lt;span&gt;'+data.title+'&lt;/span&gt;');

  // remove the selector
  $(this).on('close', function(){
    $(this).siblings('span').remove();
  });
};
</pre>
</div>
</div>
<div class="section" id="display">
<h1>Display</h1>
<p>jQuery Preview has no concept of displaying the item in a feed. This should be
handled by the developer. This is a simple example from one of the demos:</p>
<pre class="literal-block">
$('#preview_form').on('submit', function(){
  // Preview data.
  var preview = $('#id_url').data('preview');

  // Close the selector
  $('#id_url').trigger('close');
  $('#id_url').val('');

  // Create a post using mustache, i.e. the nice way.
  var template = ['&lt;div class=&quot;row&quot;&gt;',
    '&lt;div class=&quot;large-3 columns&quot;&gt;',
      '&lt;img class=&quot;thumb&quot; src=&quot;{{thumbnail_url}}&quot;&gt;&lt;/img&gt;',
    '&lt;/div&gt;',
    '&lt;div class=&quot;large-9 column&quot;&gt;',
      '&lt;a href=&quot;{{original_url}}&quot;&gt;{{title}}&lt;/a&gt;',
      '&lt;p&gt;{{description}}&lt;/p&gt;',
    '&lt;/div&gt;',
  '&lt;/div&gt;'].join('');

  html = $(Mustache.to_html(template, preview));
  html.data('preview', preview);
  html.on('click', function(){
    var data = $(this).data('preview');
    // Insert the video or rich object.
    if (data.media.type === 'video' || data.media.type === 'rich'){
      $(this).html(data.media.html);
      return false;
    }
    return true;
  });
  // Display the item in the feed.
  $('#feed').append(html);
  return false;
});
</pre>
</div>
<div class="section" id="server-side">
<h1>Server Side</h1>
<p>When the user submits the link, we must save it and echo it back to the page
so it can be displayed. The code contains a simple <a class="reference external" href="http://www.tornadoweb.org/">Tornado</a> example of this dance in <a class="reference external" href="https://github.com/embedly/jquery-preview/blob/master/demo/stream/app.py">app.py</a>.
When we set up the form we need to specify where we are going to be making the
the AJAX post. In this case it's '/update':</p>
<pre class="literal-block">
&lt;form method=&quot;post&quot; action=&quot;/update&quot;&gt;
  &lt;input type=&quot;text&quot; class=&quot;xlarge&quot; name=&quot;url&quot; id=&quot;id_url&quot; /&gt;
  &lt;input id=&quot;id_submit&quot; type=&quot;submit&quot; class=&quot;btn btn-primary&quot; value=&quot;Share&quot;/&gt;
&lt;/form&gt;
</pre>
<p>We then build a handler to deal with the form data:</p>
<pre class="literal-block">
class UpdateHandler(tornado.web.RequestHandler):

    def post(self):
        #Overly verbose
        data = {}
        for name in ['type', 'original_url', 'url', 'title', 'description',
            'favicon_url', 'provider_url', 'provider_display', 'safe',
            'html', 'thumbnail_url', 'object_type', 'image_url']:
            data[name] = self.get_argument(name, None)

        # This also works
        # data = dict([(k, v[0]) for k, v in self.request.arguments.items()])

        # Save the data off and return the object that we will pass back.
        obj = db.save(data)

        # Write a json response
        self.write(json.dumps(obj))
</pre>
<p>Once the data is successfully posted the response is passed into the Display
object to be rendered and displayed.</p>
</div>
<div class="section" id="cdn">
<h1>CDN</h1>
<p>To get you going even faster, Embedly hosts all the files you need on
scripts.embed.ly. The latest version is available here:</p>
<pre class="literal-block">
http://scripts.embed.ly/p/0.3/jquery.preview.min.js
http://scripts.embed.ly/p/0.3/jquery.preview.full.min.js
http://scripts.embed.ly/p/0.3/css/preview.css
</pre>
</div>
<div class="section" id="development">
<h1>Development</h1>
<p>The code is broken down into modules in the <tt class="docutils literal">src</tt> folder and built by
<tt class="docutils literal">grunt</tt>. If you want to modify anything in <tt class="docutils literal">preview.jquery.js</tt> please
find the code in the module and run <tt class="docutils literal">grunt run</tt> to build
<tt class="docutils literal">preview.jquery.js</tt>. <tt class="docutils literal">preview.css</tt> is a <a class="reference external" href="http://sass-lang.com/">sass</a>
generated file. Please modify <tt class="docutils literal">preview.scss</tt> by running <tt class="docutils literal">sass <span class="pre">--watch</span>
preview.scss:preview.css</tt></p>
</div>
<div class="section" id="changelog">
<h1>Changelog</h1>
<div class="section" id="id2">
<h2>0.3</h2>
<ul class="simple">
<li>Full rewrite to simplify adding jQuery to a site.</li>
</ul>
</div>
<div class="section" id="id3">
<h2>0.2</h2>
<ul class="simple">
<li>Added the $.preview so it can be used before the a form is initialized.</li>
<li>Added <tt class="docutils literal">error</tt> and <tt class="docutils literal">callback</tt> to the Preview object.</li>
</ul>
</div>
</div>
<!-- End Generated -->

          </div>
        </div>
      </div>
    </div>

    <script>

    $(document).ready(function(){

      $('#id_url').preview({key: 'c31f5208f04511e0b79e4040d3dc5c07', // Sign up for a key: http://embed.ly/pricing
                            bind: false,
                            query : {
                              autoplay : 1,
                              maxwidth: 600
                            }})
                  .on('loading', function(){
                    $(this).prop('disabled', true);
                    $('form .button').html('<i class="icon-spinner icon-spin"></i>');
                  }).on('loaded', function(){
                    $(this).prop('disabled', false);
                    $('form .button').text('Share');
                    $('.arrow p').text('Now Share it!');
                  })

      $('#id_attach').bind('click', function(e){
        if ($(this).text() == 'Attach'){
          $('#id_url').trigger('preview');
        } else {

          var preview = $('#id_url').data('preview');
          $('#id_url').trigger('close');
          $('#id_url').val('');

          // Create a post using mustache, i.e. the nice way.
          var template = ['<div class="row">',
            '<div class="large-3 columns">',
              '<img class="thumb" src="{{thumbnail_url}}"></img>',
            '</div>',
            '<div class="large-9 column">',
              '<a href="{{original_url}}">{{title}}</a>',
              '<p>{{description}}</p>',
            '</div>',
          '</div>'].join('');

          html = $(Mustache.to_html(template, preview));
          html.data('preview', preview);
          html.on('click', function(){
            var data = $(this).data('preview');
            // Insert the video or rich object.
            if (data.media.type === 'video' || data.media.type === 'rich'){
              $(this).html(data.media.html);
              return false;
            }
            return true;
          })
          $('#feed').append(html);
        }
      });
    });
    </script>

  </body>
</html>
